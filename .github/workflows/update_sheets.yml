name: NEBL Live Stats to Google Sheets

on:
  schedule:
    - cron: '*/1 * * * *'  # Run every minute
  workflow_dispatch:  # Allow manual trigger
  push:
    branches:
      - main

jobs:
  fetch-and-update:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4 google-api-python-client google-auth-oauthlib playwright
        playwright install chromium
    
    - name: Run fetcher and update Sheets
      env:
        GAME_ID: ${{ secrets.GAME_ID || '2799697' }}
        SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID || '1B5y_9uVwHfC_9Gw1sKC6YJesaOG_xe3ACWPJTra8K14' }}
        GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
      run: python .github/workflows/update_sheets.py
    
    - name: Log completion
      run: echo "Sheets updated successfully"
