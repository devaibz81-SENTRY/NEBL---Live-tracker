name: NEBL Live Stats to Google Sheets

on:
  schedule:
    - cron: '*/1 * * * *'  # Run every minute
  workflow_dispatch:  # Allow manual trigger
    inputs:
      game_url:
        description: 'Game URL (e.g., https://fibalivestats.dcd.shared.geniussports.com/u/BBF/2799697)'
        required: true
        default: ''
      spreadsheet_id:
        description: 'Spreadsheet ID'
        required: true
        default: ''
  push:
    branches:
      - main

jobs:
  fetch-and-update:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4 google-api-python-client google-auth-oauthlib playwright
        playwright install chromium
    
    - name: Run fetcher and update Sheets
      env:
        GAME_URL: ${{ github.event.inputs.game_url || secrets.GAME_URL }}
        SPREADSHEET_ID: ${{ github.event.inputs.spreadsheet_id || secrets.SPREADSHEET_ID }}
        GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
      run: python .github/workflows/update_sheets.py
    
    - name: Log completion
      run: echo "Sheets updated successfully"
