<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEBL Live Stats - Command Center</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #fff; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; color: #e94560; }
        .card { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 25px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .card h2 { color: #0f3460; margin-bottom: 15px; font-size: 1.2rem; }
        .score-display { display: flex; justify-content: center; align-items: center; gap: 40px; margin: 20px 0; }
        .team { text-align: center; }
        .team-name { font-size: 1.5rem; font-weight: bold; margin-bottom: 10px; }
        .score { font-size: 4rem; font-weight: bold; color: #e94560; }
        .vs { font-size: 2rem; color: #666; }
        .game-info { text-align: center; font-size: 1.2rem; color: #aaa; }
        .btn { background: #e94560; color: #fff; border: none; padding: 15px 30px; font-size: 1rem; border-radius: 8px; cursor: pointer; transition: transform 0.2s, background 0.2s; }
        .btn:hover { transform: scale(1.05); background: #ff6b6b; }
        .btn:disabled { background: #666; cursor: not-allowed; }
        .btn-small { padding: 8px 16px; font-size: 0.9rem; }
        .btn-group { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .link-card a { color: #4ecca3; font-size: 1.1rem; display: block; margin: 8px 0; }
        .log { background: #0f0f23; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.85rem; max-height: 250px; overflow-y: auto; white-space: pre-wrap; }
        .log-entry { margin: 5px 0; }
        .log-entry.error { color: #e94560; }
        .log-entry.success { color: #4ecca3; }
        .log-entry.info { color: #4fc3f7; }
        .log-entry.warning { color: #ffb74d; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #aaa; }
        .form-group input { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #1a1a2e; color: #fff; font-size: 1rem; }
        .form-group input:focus { outline: none; border-color: #e94560; }
        
        .config-section { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .stat-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; text-align: center; }
        .stat-label { font-size: 0.8rem; color: #aaa; }
        .stat-value { font-size: 1.2rem; font-weight: bold; color: #4ecca3; }
        
        .api-status { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .api-dot { width: 10px; height: 10px; border-radius: 50%; }
        .api-dot.green { background: #4ecca3; }
        .api-dot.red { background: #e94560; }
        .api-dot.yellow { background: #ffb74d; }
        
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { background: transparent; border: 1px solid #444; padding: 8px 16px; }
        .tab-btn.active { background: #e94560; border-color: #e94560; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÄ NEBL Live Stats Command Center</h1>
        
        <!-- Configuration -->
        <div class="card">
            <h2>‚öôÔ∏è Configuration</h2>
            <div class="config-section">
                <div class="form-group">
                    <label>Game ID</label>
                    <input type="text" id="gameId" value="2799697" onchange="updateConfig()">
                </div>
                <div class="form-group">
                    <label>Spreadsheet ID</label>
                    <input type="text" id="spreadsheetId" value="1B5y_9uVwHfC_9Gw1sKC6YJesaOG_xe3ACWPJTra8K14" onchange="updateConfig()">
                </div>
            </div>
            <div class="form-group">
                <label>Game URL (paste full Genius Sports URL)</label>
                <input type="text" id="gameUrl" placeholder="Paste game URL (e.g., fibalivestats.dcd.shared.geniussports.com/u/BBF/XXXXXXX)" onchange="parseGameUrl()">
            </div>
        </div>
        
        <!-- Live Score -->
        <div class="card">
            <div class="api-status">
                <div class="api-dot" id="statusDot"></div>
                <span id="statusText">Initializing...</span>
            </div>
            <div class="score-display">
                <div class="team">
                    <div class="team-name" id="homeTeam">-</div>
                    <div class="score" id="homeScore">-</div>
                </div>
                <div class="vs">VS</div>
                <div class="team">
                    <div class="team-name" id="awayTeam">-</div>
                    <div class="score" id="awayScore">-</div>
                </div>
            </div>
            <div class="game-info">
                <span id="period">Period: -</span> | <span id="clock">Clock: -</span>
            </div>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Home Fouls</div>
                    <div class="stat-value" id="homeFouls">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Away Fouls</div>
                    <div class="stat-value" id="awayFouls">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Timeouts</div>
                    <div class="stat-value" id="timeouts">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Last Update</div>
                    <div class="stat-value" id="lastUpdateTime">-</div>
                </div>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="card">
            <h2>üéÆ Controls</h2>
            <div class="btn-group">
                <button class="btn" id="refreshBtn" onclick="refreshData()">üîÑ Refresh Now</button>
                <button class="btn" id="autoRefreshBtn" onclick="toggleAutoRefresh()">‚è∏Ô∏è Auto: ON</button>
                <button class="btn" id="sheetsBtn" onclick="updateSheets()">üìä Update Sheets</button>
            </div>
            <div class="log" id="log"></div>
        </div>
        
        <!-- Quick Links -->
        <div class="card link-card">
            <h2>üîó Quick Links</h2>
            <a id="sheetLink" href="#" target="_blank">üìä Google Sheet</a>
            <a href="https://github.com/devaibz81-SENTRY/NEBL---Live-tracker/actions" target="_blank">‚öôÔ∏è GitHub Actions</a>
            <a id="sourceLink" href="#" target="_blank">üèÄ Live Stats Source</a>
        </div>
    </div>

    <script>
        let GAME_ID = '';
        let SPREADSHEET_ID = '';
        let BASE_URL = '';
        let autoRefreshInterval = null;
        let autoRefreshEnabled = true;
        
        function updateConfig() {
            GAME_ID = document.getElementById('gameId').value.trim();
            SPREADSHEET_ID = document.getElementById('spreadsheetId').value.trim();
            BASE_URL = `https://fibalivestats.dcd.shared.geniussports.com/u/BBF/${GAME_ID}`;
            
            document.getElementById('sheetLink').href = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit`;
            document.getElementById('sourceLink').href = BASE_URL;
            
            log(`Config updated - Game: ${GAME_ID}, Sheet: ${SPREADSHEET_ID}`, 'info');
            localStorage.setItem('nebl_gameId', GAME_ID);
            localStorage.setItem('nebl_spreadsheetId', SPREADSHEET_ID);
        }
        
        function parseGameUrl() {
            const url = document.getElementById('gameUrl').value.trim();
            if (url) {
                const match = url.match(/\/u\/BBF\/(\d+)/);
                if (match) {
                    document.getElementById('gameId').value = match[1];
                    updateConfig();
                    log(`Parsed Game ID: ${match[1]}`, 'success');
                } else {
                    log('Invalid URL - could not extract Game ID', 'error');
                }
            }
        }
        
        function loadConfig() {
            const savedGameId = localStorage.getItem('nebl_gameId');
            const savedSpreadsheetId = localStorage.getItem('nebl_spreadsheetId');
            if (savedGameId) document.getElementById('gameId').value = savedGameId;
            if (savedSpreadsheetId) document.getElementById('spreadsheetId').value = savedSpreadsheetId;
            updateConfig();
        }
        
        function log(msg, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function setStatus(status, text) {
            const dot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            dot.className = 'api-dot ' + status;
            statusText.textContent = text;
        }
        
        async function fetchScoreboard() {
            if (!GAME_ID) {
                log('No game ID configured. Enter game URL above.', 'warning');
                setStatus('yellow', 'Waiting for game URL...');
                return;
            }
            try {
                log(`Fetching from ${BASE_URL}/index.html...`);
                const response = await fetch(`${BASE_URL}/index.html`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const html = await response.text();
                
                if (html.length < 1000) {
                    throw new Error('Empty or minimal response - game may not be available');
                }
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                const homeTeam = doc.getElementById('aj_1_shortName')?.textContent?.trim() || 'Home';
                const awayTeam = doc.getElementById('aj_2_shortName')?.textContent?.trim() || 'Away';
                const homeScore = doc.getElementById('aj_1_score')?.textContent?.trim() || '0';
                const awayScore = doc.getElementById('aj_2_score')?.textContent?.trim() || '0';
                const period = doc.getElementById('aj_period')?.textContent?.trim() || '';
                const clock = doc.getElementById('aj_clock')?.textContent?.trim() || '';
                
                document.getElementById('homeTeam').textContent = homeTeam;
                document.getElementById('awayTeam').textContent = awayTeam;
                document.getElementById('homeScore').textContent = homeScore;
                document.getElementById('awayScore').textContent = awayScore;
                document.getElementById('period').textContent = period ? `Period: ${period}` : 'Period: -';
                document.getElementById('clock').textContent = clock ? `Clock: ${clock}` : 'Clock: -';
                
                document.getElementById('lastUpdateTime').textContent = new Date().toLocaleTimeString();
                
                setStatus('green', 'Connected - Live');
                log(`‚úì Score: ${homeTeam} ${homeScore} - ${awayScore} ${awayTeam} | ${period} ${clock}`, 'success');
                return true;
            } catch (e) {
                log(`‚úó Error: ${e.message}`, 'error');
                setStatus('red', 'Error: ' + e.message);
                return false;
            }
        }
        
        async function refreshData() {
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Refreshing...';
            
            await fetchScoreboard();
            
            btn.disabled = false;
            btn.textContent = 'üîÑ Refresh Now';
        }
        
        async function updateSheets() {
            if (!GAME_ID) {
                log('Please enter a game URL first', 'warning');
                return;
            }
            
            const btn = document.getElementById('sheetsBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Updating...';
            log('Triggering GitHub workflow to update sheets...');
            
            // Note: To trigger workflow from browser, user needs to manually run it in GitHub Actions
            // Or set up a GitHub App with repository dispatch
            log('To update sheets: Go to GitHub Actions ‚Üí Run workflow ‚Üí Enter Game ID', 'info');
            log('Or set GAME_ID in GitHub Secrets for auto-updates', 'info');
            
            btn.disabled = false;
            btn.textContent = 'üìä Update Sheets';
        }
        
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const btn = document.getElementById('autoRefreshBtn');
            
            if (autoRefreshEnabled) {
                btn.textContent = '‚è∏Ô∏è Auto: ON';
                btn.style.background = '#e94560';
                autoRefreshInterval = setInterval(refreshData, 1000);
                log('Auto-refresh enabled (1s)', 'info');
            } else {
                btn.textContent = '‚ñ∂Ô∏è Auto: OFF';
                btn.style.background = '#666';
                clearInterval(autoRefreshInterval);
                log('Auto-refresh disabled', 'info');
            }
        }
        
        // Initialize
        loadConfig();
        refreshData();
        
        // Auto-refresh every 1 second
        autoRefreshInterval = setInterval(refreshData, 1000);
    </script>
</body>
</html>
